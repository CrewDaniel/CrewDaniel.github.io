<!DOCTYPE html><html lang="ko" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="[Android] 동영상에 그림 그리기 (2) - Surface" /><meta property="og:locale" content="ko" /><meta name="description" content="이미지 스트림 버퍼의 전달 방법에 대해" /><meta property="og:description" content="이미지 스트림 버퍼의 전달 방법에 대해" /><link rel="canonical" href="https://crewdaniel.github.io/posts/video_memo_2/" /><meta property="og:url" content="https://crewdaniel.github.io/posts/video_memo_2/" /><meta property="og:site_name" content="Devroid" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-12-21T00:00:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="[Android] 동영상에 그림 그리기 (2) - Surface" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"description":"이미지 스트림 버퍼의 전달 방법에 대해","url":"https://crewdaniel.github.io/posts/video_memo_2/","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://crewdaniel.github.io/posts/video_memo_2/"},"headline":"[Android] 동영상에 그림 그리기 (2) - Surface","dateModified":"2022-01-19T01:20:00+09:00","datePublished":"2021-12-21T00:00:00+09:00","@context":"https://schema.org"}</script><title>[Android] 동영상에 그림 그리기 (2) - Surface | Devroid</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Devroid"><meta name="application-name" content="Devroid"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div class="site-title mt-3"> <a href="/">Devroid</a></div><div class="site-subtitle">안드로이드 개발 일지</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/CrewDaniel" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['alaskay','naver.com'].join('@')" aria-label="email" class="order-4" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-5" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>[Android] 동영상에 그림 그리기 (2) - Surface</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>[Android] 동영상에 그림 그리기 (2) - Surface</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Taehyun Park </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Tue, Dec 21, 2021, 12:00 AM +0900" >Dec 21, 2021<i class="unloaded">2021-12-21T00:00:00+09:00</i> </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Wed, Jan 19, 2022, 1:20 AM +0900" >Jan 19<i class="unloaded">2022-01-19T01:20:00+09:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1829 words">10 min read</span></div></div><div class="post-content"><p>동영상에 그림을 그려넣기 위해서 동영상을 각 프레임으로 나누어 그린 후 사용자에게 보여주고, 재생하기로 하였습니다(<a href="https://crewdaniel.github.io/posts/boomerang/">지난 포스트 참고</a>). 그렇다면 어떻게 동영상을 프레임으로 나누어 그릴 수 있을까요?</p><p><a href="https://developer.android.com/reference/android/graphics/SurfaceTexture">SurfaceTexture</a>는 이미지 스트림에서 프레임을 캡처하여 OpenGL ES의 Texture로 저장합니다.</p><p>이미지 스트림에 대한 설명은 <a href="https://source.android.com/devices/graphics">AOSP 그래픽 개요</a> 문서에서 적혀 있듯이, 이미지 스트림 생산자에서 생성한 그래픽 버퍼를 이미지 스트림 소비자로 옮깁니다. 그 과정에서 버퍼를 옮기기 위해 사용하는 클래스가 Surface입니다.</p><p>SurfaceTexture를 Surface + Texture로 생각하고 이 둘을 먼저 이해하는 것이 기능의 이해에 도움이 될 것입니다.</p><h1 id="surface">Surface</h1><p><a href="https://developer.android.com/reference/android/view/Surface">Surface</a> (<a href="https://source.android.com/devices/graphics/arch-sh">AOSP - Surface</a>)는 이미지 스트림 생산자와 소비자 사이에서 버퍼를 전달하도록 하는 역할을 합니다.</p><p>Surface는 이미지 스트림 소비자에서 생성하여 이미지 스트림 생산자에 전달하여 그리게 합니다. 그림을 그릴 종이를 전해주고, 생산자가 그 곳에 그림을 그리면 다시 종이를 가져온다고 생각하면 됩니다. 종이는 소비자가 생산자에게 주었지만, 그림은 생산자가 소비자에게 준 것이죠.</p><p>아래부터 실제 구현 방식을 정리하겠습니다. Surface의 생성자 중 하나를 예로 들어보겠습니다.</p><h2 id="생성자">생성자</h2><div class="language-kotlin highlighter-rouge"><div class="code-header"> <span text-data=" Kotlin "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nc">Surface</span><span class="p">(</span><span class="n">surfaceTexture</span><span class="p">:</span> <span class="nc">SurfaceTexture</span><span class="p">)</span>
</pre></table></code></div></div><p>생성자의 파라미터로 이미지 스트림 소비자 중 하나인 SurfaceTexture가 들어갑니다. 여기서 만들어진 Surface 인스턴스에 버퍼를 넣으면, SurfaceTexture에서 사용할 수 있게 됩니다. 그렇다면 이제 이미지 스트림 생성자를 찾아 Surface 인스턴스를 전달하면 될 것입니다.</p><h2 id="surface를-가져오는-다른-방법">Surface를 가져오는 다른 방법</h2><p>Surface 클래스에서 직접 인스턴스를 생성하는 방법 외에도 Surface를 가져올 수 있는 방법이 있습니다. 몇몇 클래스에서 Surface를 가져올 수 있는 기능을 제공하는데, 바로 이 앱에서 사용자에게 동영상을 보여주는 SurfaceView와, 동영상을 저장하는 MediaCodec이 이에 해당합니다! 동영상에 그림을 그리는 기능은 전체에 걸쳐 Surface가 중요한 기능을 하는 것이죠.</p><h3 id="surfaceview">SurfaceView</h3><p>SurfaceView는 화면에 보여지는 부분이므로 Button, TextView와 같은 다른 View처럼 레이아웃 파일에 뷰 계층구조의 일부로 포함되어야합니다. 하지만 Inflate 이후 바로 사용할 수 있는 다른 View들과 다르게 SurfaceView는 Inflate 이후 바로 사용할 수 없습니다. Surface가 생성된 이후에 사용을 해야 하는데, 이에 대한 콜백 인터페이스가 제공되기 때문에, 이를 사용하면 됩니다. 이에 대한 자세한 설명은 아래 <code class="language-plaintext highlighter-rouge">SurfaceHolder</code>에서 이어가겠습니다.</p><h3 id="mediacodec">MediaCodec</h3><p>MediaCodec도 인코딩할 동영상의 버퍼를 Surface로 받을 수 있습니다. <code class="language-plaintext highlighter-rouge">createInputSurface()</code> 함수를 사용하면 Surface를 반환합니다. 이 Surface에 렌더링을 할 때는 하드웨어 가속을 지원하는 API를 사용하는 것이 권장됩니다. 대표적으로 OpenGL ES가 있고, Canvas도 <a href="https://developer.android.com/reference/android/view/Surface#lockHardwareCanvas()">lockHardwareCanvas()</a> 함수를 사용하여 반환받을 시에는 하드웨어 가속이 적용됩니다.</p><h2 id="surfaceholder">SurfaceHolder</h2><p>Surface의 소유권을 앱과 공유하기 위한 인터페이스입니다. 콜백을 통해 Surface의 상태 변화를 수신할 수 있습니다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span text-data=" Java "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Callback</span> <span class="o">{</span>
    <span class="kt">void</span> <span class="nf">surfaceCreated</span><span class="o">(</span><span class="nd">@NonNull</span> <span class="nc">SurfaceHolder</span> <span class="n">var1</span><span class="o">);</span>

    <span class="kt">void</span> <span class="nf">surfaceChanged</span><span class="o">(</span><span class="nd">@NonNull</span> <span class="nc">SurfaceHolder</span> <span class="n">var1</span><span class="o">,</span> <span class="kt">int</span> <span class="n">var2</span><span class="o">,</span> <span class="kt">int</span> <span class="n">var3</span><span class="o">,</span> <span class="kt">int</span> <span class="n">var4</span><span class="o">);</span>

    <span class="kt">void</span> <span class="nf">surfaceDestroyed</span><span class="o">(</span><span class="nd">@NonNull</span> <span class="nc">SurfaceHolder</span> <span class="n">var1</span><span class="o">);</span>
<span class="o">}</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">SurfaceHolder.class</code>의 코드 중 콜백에 해당하는 부분입니다. 액티비티나 프래그먼트에서 <code class="language-plaintext highlighter-rouge">SurfaceHolder.Callback</code>을 인터페이스 상속하여 구현하면 됩니다. 콜백이 호출되는 순서는 일반적으로 아래와 같습니다.</p><p>액티비티가 시작되면</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Plaintext "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>onCreate() -&gt; onStart() -&gt; onResume() -&gt; surfaceCreated() -&gt; surfaceChanged()
</pre></table></code></div></div><p>의 순서로 호출이 됩니다. 또한 액티비티가 포그라운드에서 사라질 때</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Plaintext "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>onPause() -&gt; surfaceDestroyed()
</pre></table></code></div></div><p>의 순서로 호출이 됩니다.</p><p>SurfaceView의 Surface를 가져오기 위해서는 SurfaceView에서 직접 가져오는 방식이 아닌, SurfaceHolder에서 가져오는 방식을 사용하여야 합니다.</p><div class="language-kotlin highlighter-rouge"><div class="code-header"> <span text-data=" Kotlin "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="k">override</span> <span class="k">fun</span> <span class="nf">surfaceCreated</span><span class="p">(</span><span class="n">p0</span><span class="p">:</span> <span class="nc">SurfaceHolder</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">surface</span> <span class="p">=</span> <span class="n">p0</span><span class="p">.</span><span class="n">surface</span>
<span class="p">}</span>
</pre></table></code></div></div><p>이렇게 가져오면 됩니다.</p><p>액티비티, 프래그먼트 생명 주기와 WeakReference인 Surface의 특성으로 인해 <code class="language-plaintext highlighter-rouge">surfaceDestroyed()</code>가 호출될 가능성이 항상 존재하기 때문에 Surface가 파괴되고 다시 생성될 가능성에 항상 대비하여야 합니다.</p><h2 id="surface의-사용">Surface의 사용</h2><p>지난 포스트에서 소개해드린 구조를 다시 한 번 살펴봅시다.</p><p><img data-proofer-ignore data-src="/assets/img/video_memo_1/videomemofix.png" alt="intro" /></p><p>여기에서 화살표는 모두 Surface 클래스를 통해 이미지 버퍼가 전달되는 만큼, Surface 클래스는 기능의 구현에 있어 가장 핵심적인 요소입니다. 그렇다면 이제 화살표가 어떻게 연결되는지, 즉 이미지 스트림의 소비자와 생산자는 어떻게 연결되는지 알아보겠습니다.</p><h2 id="이미지-스트림-소비자와-생산자-연결">이미지 스트림 소비자와 생산자 연결</h2><div class="language-kotlin highlighter-rouge"><div class="code-header"> <span text-data=" Kotlin "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nc">MediaPlayer</span><span class="p">.</span><span class="nf">setSurface</span><span class="p">(</span><span class="n">surface</span><span class="p">:</span> <span class="nc">Surface</span><span class="p">)</span>
</pre></table></code></div></div><p>동영상을 재생하는 MediaPlayer 클래스를 예로 들면, setSurface 함수에 위에서 생성한 Surface 인스턴스를 전달하면 됩니다.</p><p>이제 MediaPlayer에서 동영상을 재생하면, Surface를 통해 SurfaceTexture로 버퍼가 넘어갈 것입니다. 이제는 프레임 단위로 나눌 차례입니다.</p><h1 id="surfacetexture">SurfaceTexture</h1><h2 id="onframeavailablelistener">onFrameAvailableListener</h2><div class="language-kotlin highlighter-rouge"><div class="code-header"> <span text-data=" Kotlin "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="n">surfaceTexture</span><span class="p">.</span><span class="nf">setOnFrameAvailableListener</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>

<span class="k">override</span> <span class="k">fun</span> <span class="nf">onFrameAvailable</span><span class="p">(</span><span class="n">p0</span><span class="p">:</span> <span class="nc">SurfaceTexture</span><span class="p">?)</span> <span class="p">{</span>
    <span class="c1">// 새로운 Frame에 그림 그리기</span>
<span class="p">}</span>
</pre></table></code></div></div><p>방법은 의외로 간단합니다! SurfaceTexture가 새로운 프레임을 받을 때마다 호출되는 콜백 인터페이스를 가지고 있기 때문입니다. 콜백 인터페이스를 상속하고, 오버라이드하기만 하면 됩니다. 콜백 인터페이스의 대상이 되는 Fragment나 Activity를 <code class="language-plaintext highlighter-rouge">setOnFrameAvailableListner()</code>를 통해 전달하는 코드 한 줄만 더하면 됩니다.</p><p>SurfaceTexture에 대한 내용은 이후 텍스처에 대한 설명과 함께 자세히 다루어보도록 하겠습니다.</p><p>이제 새로운 프레임에 그림을 그려야 합니다. <code class="language-plaintext highlighter-rouge">SurfaceTexture.updateTexImage()</code>함수를 사용하여 새로 받은 프레임을 Texture로 사용할 수 있습니다. Texture는 무엇이고 그림은 어떻게 그릴 수 있는 것일까요? 이 내용부터는 OpenGL ES에 대한 설명이 동반 되어야 하므로 다음 포스트에 이어서 작성하도록 하겠습니다.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/android/'>Android</a>, <a href='/categories/boomerang/'>boomerang</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/android/" class="post-tag no-text-decoration" >Android</a> <a href="/tags/surface/" class="post-tag no-text-decoration" >Surface</a> <a href="/tags/surfacetexture/" class="post-tag no-text-decoration" >SurfaceTexture</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=[Android] 동영상에 그림 그리기 (2) - Surface - Devroid&url=https://crewdaniel.github.io/posts/video_memo_2/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=[Android] 동영상에 그림 그리기 (2) - Surface - Devroid&u=https://crewdaniel.github.io/posts/video_memo_2/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=[Android] 동영상에 그림 그리기 (2) - Surface - Devroid&url=https://crewdaniel.github.io/posts/video_memo_2/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/cs_3/">[CS] 비동기 프로그래밍 (3) - 동시성 프로그래밍</a><li><a href="/posts/cs_2/">[CS] 비동기 프로그래밍 (2) - 리눅스의 프로세스, 스레드, 태스크</a><li><a href="/posts/cs_1/">[CS] 비동기 프로그래밍 (1) - 캐시 메모리</a><li><a href="/posts/video_memo_10/">[Android] 동영상에 그림 그리기 (10) - 개선 리스트</a><li><a href="/posts/video_memo_8/">[Android] 동영상에 그림 그리기 (8) - BufferQueue, WindowManager, SurfaceFlinger</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/android/">Android</a> <a class="post-tag" href="/tags/opengl-es/">OpenGL ES</a> <a class="post-tag" href="/tags/cs/">CS</a> <a class="post-tag" href="/tags/surface/">Surface</a> <a class="post-tag" href="/tags/egl/">EGL</a> <a class="post-tag" href="/tags/shader/">Shader</a> <a class="post-tag" href="/tags/surfacetexture/">SurfaceTexture</a> <a class="post-tag" href="/tags/async/">Async</a> <a class="post-tag" href="/tags/asynchronous/">Asynchronous</a> <a class="post-tag" href="/tags/boostcamp/">boostcamp</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/video_memo_4/"><div class="card-body"> <span class="timeago small" >Dec 31, 2021<i class="unloaded">2021-12-31T00:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[Android] 동영상에 그림 그리기 (4) - OpenGL ES의 Texture</h3><div class="text-muted small"><p> 이제 그림을 그릴 시간입니다. Android에서 OpenGL ES 렌더링 과정, 특히 SurfaceTexture를 사용하여 이미지를 텍스처로 사용하는 과정에 대해 정리하겠습니다. SurfaceTexture Texture 초기화 지난 글에서 onFrameAvailableListener를 통해 새로운 이미지 프레임을 받은 것을 알 수 있다고 하였습니...</p></div></div></a></div><div class="card"> <a href="/posts/video_memo_8/"><div class="card-body"> <span class="timeago small" >Jan 12<i class="unloaded">2022-01-12T02:12:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[Android] 동영상에 그림 그리기 (8) - BufferQueue, WindowManager, SurfaceFlinger</h3><div class="text-muted small"><p> 이전 포스트들에서 SurfaceTexture, Surface, MediaCodec 등 미디어, 그래픽에 쓰이는 API들에 대해 다루었습니다.. 이러한 API들의 역할과 사용 방법에 대해서는 다루었지만, 작동 방식에 대해 조금 더 깊이 알아보고 싶어서 Google I/O ‘18의 Drawn out: How Android renders 라는 주제의 발표와...</p></div></div></a></div><div class="card"> <a href="/posts/video_memo_9/"><div class="card-body"> <span class="timeago small" >Jan 13<i class="unloaded">2022-01-13T01:15:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[Android] 동영상에 그림 그리기 (9) - SurfaceView로 화면 표시</h3><div class="text-muted small"><p> 지난 포스트에서는 MediaCodec에서 생성한 Surface에 비디오 버퍼를 전달하여 동영상을 저장하였습니다. 이번 포스트에서는 동영상을 사용자에게 표시하는 방법에 대해 작성하겠습니다. SurfaceView 사용자는 스스로가 그리고 있는 그림을 계속 확인하여야 하기 때문에, 화면에 표시될 것은 원본 동영상이 아닌 그림이 그려진 동영상의 각 이미지...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/video_memo_1/" class="btn btn-outline-primary" prompt="Older"><p>[Android] 동영상에 그림 그리기 (1) - 개요</p></a> <a href="/posts/video_memo_3/" class="btn btn-outline-primary" prompt="Newer"><p>[Android] 동영상에 그림 그리기 (3) - OpenGL ES, EGL</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://github.com/CrewDaniel">Taehyun Park</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/android/">Android</a> <a class="post-tag" href="/tags/opengl-es/">OpenGL ES</a> <a class="post-tag" href="/tags/cs/">CS</a> <a class="post-tag" href="/tags/surface/">Surface</a> <a class="post-tag" href="/tags/egl/">EGL</a> <a class="post-tag" href="/tags/shader/">Shader</a> <a class="post-tag" href="/tags/surfacetexture/">SurfaceTexture</a> <a class="post-tag" href="/tags/async/">Async</a> <a class="post-tag" href="/tags/asynchronous/">Asynchronous</a> <a class="post-tag" href="/tags/boostcamp/">boostcamp</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script>
